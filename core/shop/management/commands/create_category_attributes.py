from django.core.management.base import BaseCommand
from django.db import transaction
from shop.models import (
    ProductCategoryModel,
    AttributeModel,
    AttributeValueModel,
)


class Command(BaseCommand):
    help = "Create one attribute and three values ​​for each lowest category"

    def add_arguments(self, parser):
        parser.add_argument(
            "--force",
            action="store_true",
            help="Delete and recreate existing features",
        )

    def get_category_attribute(self, category_name):

        attributes_mapping = {
            # الکترونیک - موبایل و تبلت
            "گوشی هوشمند": "حافظه داخلی",
            "گوشی ساده": "حافظه داخلی",
            "تبلت": "حافظه داخلی",
            "شارژر": "طول کابل",
            "کابل اتصال": "نوع اتصال",
            "کیف و کاور": "جنس",
            "هندزفری بی‌سیم": "نوع اتصال",
            "پاوربانک": "ظرفیت",
            # الکترونیک - کامپیوتر و لپ‌تاپ
            "لپ‌تاپ": "حافظه رم",
            "کامپیوتر دسکتاپ": "حافظه رم",
            "مانیتور": "اندازه صفحه نمایش",
            "کیبورد و ماوس": "نوع اتصال",
            "کابل HDMI": "طول",
            "کارت گرافیک": "حافظه",
            "رم کامپیوتر": "ظرفیت",
            # الکترونیک - صوتی و تصویری
            "تلویزیون": "اندازه صفحه نمایش",
            "سینمای خانگی": "قدرت",
            "پخش‌کننده DVD": "فرمت‌های پشتیبانی",
            "پروژکتور": "رزولوشن",
            "اسپیکر": "قدرت",
            "هدفون بی‌سیم": "باتری",
            "هدفون سیمی": "طول کابل",
            # الکترونیک - لوازم جانبی
            "کابل شارژ": "طول",
            "شارژر دیواری": "وات",
            "شارژر فندکی": "وات",
            "هندزفری سیمی": "طول کابل",
            "کیف دوربین": "جنس",
            "کارت حافظه": "ظرفیت",
            # مد و پوشاک - مردانه
            "پیراهن": "سایز",
            "تی‌شرت": "سایز",
            "شلوار": "سایز",
            "کفش": "سایز",
            "کمربند": "سایز",
            "ساعت مچی": "سایز",
            # مد و پوشاک - زنانه
            "مانتو": "سایز",
            "لباس مجلسی": "سایز",
            "شلوار": "سایز",
            "کفش": "سایز",
            "کیف دستی": "ابعاد",
            "روسری": "ابعاد",
            # مد و پوشاک - بچه‌گانه
            "پیراهن": "سایز",
            "شلوار": "سایز",
            "سویشرت": "سایز",
            "کفش": "سایز",
            "ست بادی نوزادی": "سایز",
            "هدبند": "سایز",
            # مد و پوشاک - اکسسوری
            "گردنبند": "طول",
            "دستبند": "سایز",
            "عینک آفتابی": "ابعاد",
            "کلاه": "سایز",
            "کمربند": "سایز",
            "شال": "ابعاد",
            # خانه و آشپزخانه - لوازم آشپزخانه
            "یخچال": "ظرفیت",
            "ظرفشویی": "ظرفیت",
            "مایکروویو": "ظرفیت",
            "جاروبرقی": "قدرت",
            "کتری برقی": "ظرفیت",
            "قهوه‌ساز": "ظرفیت",
            # خانه و آشپزخانه - دکوراسیون
            "تابلو": "ابعاد",
            "قاب عکس": "ابعاد",
            "گلدان": "ابعاد",
            "فرش": "ابعاد",
            "پرده": "ابعاد",
            "کنسول و بوفه": "ابعاد",
            # خانه و آشپزخانه - خواب و حمام
            "ست حوله": "سایز",
            "ملحفه": "سایز",
            "بالش": "سایز",
            "پتو": "ابعاد",
            "سرویس خواب کودک": "سایز",
            # خانه و آشپزخانه - سرو و پذیرایی
            "سرویس غذاخوری": "تعداد تکه",
            "چای‌خوری": "تعداد تکه",
            "قهوه‌خوری": "تعداد تکه",
            "لیوان": "ظرفیت",
            "بطری": "ظرفیت",
            "سینی": "ابعاد",
            # زیبایی و سلامت - مراقبت پوست
            "کرم مرطوب‌کننده": "ظرفیت",
            "ضدآفتاب": "ظرفیت",
            "ماسک صورت": "ظرفیت",
            "سرم": "ظرفیت",
            "پاک‌کننده": "ظرفیت",
            "تونر": "ظرفیت",
            # زیبایی و سلامت - مراقبت مو
            "شامپو": "ظرفیت",
            "نرم‌کننده": "ظرفیت",
            "ماسک مو": "ظرفیت",
            "روغن مو": "ظرفیت",
            "تونیک پوست سر": "ظرفیت",
            "سرم مو": "ظرفیت",
            # زیبایی و سلامت - آرایشی
            "کرم پودر": "ظرفیت",
            "رژلب": "ظرفیت",
            "ریمل": "ظرفیت",
            "سایه چشم": "ظرفیت",
            "خط چشم": "ظرفیت",
            "لاک ناخن": "ظرفیت",
            # زیبایی و سلامت - بهداشتی
            "مسواک": "نوع",
            "خمیر دندان": "ظرفیت",
            "صابون": "وزن",
            "شامpoo بچه": "ظرفیت",
            "دستمال مرطوب": "تعداد",
            "ضدعفونی‌کننده": "ظرفیت",
            # ورزش و سفر - لوازم ورزشی
            "دمبل": "وزن",
            "مت ورزشی": "ابعاد",
            "تردمیل": "قدرت",
            "دوچرخه ثابت": "قدرت",
            "کفش ورزشی": "سایز",
            "طناب پرش": "طول",
            # ورزش و سفر - پوشاک ورزشی
            "تی‌شرت ورزشی": "سایز",
            "شلوارک": "سایز",
            "دمپایی": "سایز",
            "سویشرت": "سایز",
            "کوله‌پشتی": "ظرفیت",
            # ورزش و سفر - سفر و کمپینگ
            "چادر": "ابعاد",
            "کیسه خواب": "ابعاد",
            "چراغ قوه": "قدرت",
            "زیرانداز": "ابعاد",
            "کوله‌پشتی سفر": "ظرفیت",
            "اجاق کوهنوردی": "قدرت",
            # ورزش و سفر - ساعت و تناسب اندام
            "ساعت هوشمند": "ابعاد",
            "دستبند سلامتی": "سایز",
            "ترازو": "ظرفیت",
            "پوشیدنی تناسب اندام": "سایز",
            "هدفون ورزشی": "نوع اتصال",
            # کودک و نوزاد - اسباب‌بازی
            "عروسک": "ابعاد",
            "پازل": "تعداد تکه",
            "ماشین اسباب‌بازی": "ابعاد",
            "بازی فکری": "تعداد بازیکن",
            "بلوک ساختنی": "تعداد تکه",
            "قطار چوبی": "ابعاد",
            # کودک و نوزاد - وسایل آموزشی
            "کتاب آموزشی": "تعداد صفحه",
            "لگو": "تعداد تکه",
            "دوچرخه بچه‌گانه": "سایز",
            "ساعت آموزشی": "ابعاد",
            "فلش کارت": "تعداد کارت",
            "پازل آموزشی": "تعداد تکه",
            # کودک و نوزاد - لباس کودک
            "ست بادی": "سایز",
            "شلوار": "سایز",
            "پیراهن": "سایز",
            "کلاه": "سایز",
            "جوراب": "سایz",
            "کاپشن": "سایز",
            # کودک و نوزاد - سیسمونی
            "روروک": "ابعاد",
            "کریر": "ابعاد",
            "گهواره": "ابعاد",
            "تشک بازی": "ابعاد",
            "صندلی ماشین": "ابعاد",
            "تخت کنار مادر": "ابعاد",
            # کتاب و فرهنگ - رمان و داستان
            "رمان معاصر": "تعداد صفحه",
            "داستان کوتاه": "تعداد صفحه",
            "مجموعه داستان": "تعداد صفحه",
            "رمان نوجوان": "تعداد صفحه",
            "رمان خارجی": "تعداد صفحه",
            "داستان فلسفی": "تعداد صفحه",
            # کتاب و فرهنگ - آموزشی
            "کتاب درسی": "تعداد صفحه",
            "مهارت‌های نرم": "تعداد صفحه",
            "زبان‌های خارجی": "تعداد صفحه",
            "برنامه‌نویسی": "تعداد صفحه",
            "کسب و کار": "تعداد صفحه",
            "موفقیت": "تعداد صفحه",
            # کتاب و فرهنگ - کودک و نوجوان
            "قصه کودکانه": "تعداد صفحه",
            "شعر کودکان": "تعداد صفحه",
            "کتاب آموزشی کودک": "تعداد صفحه",
            "کتاب مصور": "تعداد صفحه",
            "کتاب سرگرمی": "تعداد صفحه",
            "کتاب شعر نوجوان": "تعداد صفحه",
            # کتاب و فرهنگ - فرهنگی و هنری
            "هنر و نقاشی": "تعداد صفحه",
            "عکاسی": "تعداد صفحه",
            "تاریخ هنر": "تعداد صفحه",
            "معماری": "تعداد صفحه",
            "موسیقی": "تعداد صفحه",
            "طراحی داخلی": "تعداد صفحه",
            # خودرو و ابزار - لوازم جانبی خودرو
            "روکش صندلی": "سایز",
            "فرش کفی": "سایز",
            "نگهدارنده موبایل": "نوع نصب",
            "دوربین خودرو": "رزولوشن",
            "پاوربانک فندکی": "ظرفیت",
            "اسپری تمیزکننده": "ظرفیت",
            # خودرو و ابزار - ابزار دستی
            "پیچ‌گوشتی": "سایز",
            "آچار": "سایز",
            "چکش": "وزن",
            "متر": "طول",
            "انبردست": "سایز",
            "تیغ و رنده": "سایز",
            # خودرو و ابزار - ابزار برقی
            "دریل": "قدرت",
            "فرز": "قدرت",
            "اره برقی": "طول تیغه",
            "پولیش": "قدرت",
            "جاروبرقی صنعتی": "قدرت",
            "سنگ‌فرز": "قدرت",
            # خودرو و ابزار - لوازم مراقبت خودرو
            "واکس بدنه": "ظرفیت",
            "شامپو بدنه": "ظرفیت",
            "واکس داشبورد": "ظرفیت",
            "پولیش": "ظرفیت",
            "اسپری لاستیک": "ظرفیت",
            "دستمال میکروفایبر": "ابعاد",
        }

        return attributes_mapping.get(category_name, "سایز")

    def get_attribute_values(self, attribute_name):

        values_mapping = {
            "حافظه داخلی": ["64GB", "128GB", "256GB"],
            "طول کابل": ["1 متر", "1.5 متر", "2 متر"],
            "نوع اتصال": ["USB-C", "Micro-USB", "Lightning"],
            "جنس": ["پلاستیک", "فلز", "چرم"],
            "ظرفیت": ["5000mAh", "10000mAh", "20000mAh"],
            "حافظه رم": ["8GB", "16GB", "32GB"],
            "اندازه صفحه نمایش": ["6 اینچ", "6.5 اینچ", "7 اینچ"],
            "طول": ["1 متر", "1.5 متر", "2 متر"],
            "وات": ["18W", "25W", "45W"],
            "قدرت": ["50W", "100W", "200W"],
            "باتری": ["3000mAh", "4000mAh", "5000mAh"],
            "ابعاد": ["کوچک", "متوسط", "بزرگ"],
            "فرمت‌های پشتیبانی": ["MP3", "MP4", "AVI"],
            "رزولوشن": ["HD", "Full HD", "4K"],
            "سایز": ["S", "M", "L"],
            "تعداد تکه": ["2 تکه", "4 تکه", "6 تکه"],
            "وزن": ["1kg", "2kg", "5kg"],
            "نوع": ["نرم", "متوسط", "سفت"],
            "تعداد": ["10 عدد", "20 عدد", "30 عدد"],
            "ظرفیت": ["250ml", "500ml", "1L"],
            "تعداد صفحه": ["100 صفحه", "200 صفحه", "300 صفحه"],
            "نوع نصب": ["چسبی", "مغناطیسی", "مکشی"],
            "رزولوشن": ["720p", "1080p", "4K"],
            "طول تیغه": ["20cm", "30cm", "40cm"],
        }

        return values_mapping.get(attribute_name, ["کوچک", "متوسط", "بزرگ"])

    @transaction.atomic
    def handle(self, *args, **options):
        force = options["force"]

        leaf_categories = ProductCategoryModel.objects.filter(
            children__isnull=True
        )

        created_attributes = 0
        created_values = 0

        for category in leaf_categories:
            self.stdout.write(f"Processing category: {category.name}")

            attribute_name = self.get_category_attribute(category.name)

            attribute, created = AttributeModel.objects.get_or_create(
                name=attribute_name
            )

            if created:
                created_attributes += 1
                self.stdout.write(
                    self.style.SUCCESS(
                        f" ✓ Attribute '{attribute_name}' created"
                    )
                )
            else:
                self.stdout.write(
                    self.style.NOTICE(
                        f" - Attribute '{attribute_name}' already exists"
                    )
                )

            value_names = self.get_attribute_values(attribute_name)

            for value_name in value_names:
                value, value_created = (
                    AttributeValueModel.objects.get_or_create(
                        attribute=attribute, value=value_name
                    )
                )

                if value_created:
                    created_values += 1
                    self.stdout.write(
                        self.style.SUCCESS(f" ✓ Value '{value_name}' created")
                    )
                else:
                    self.stdout.write(
                        self.style.NOTICE(
                            f" - Value '{value_name}' already exists"
                        )
                    )

        self.stdout.write(
            self.style.SUCCESS(
                f"\nDone!\n"
                f"• Number of categories processed: {leaf_categories.count()}\n"
                f"• Number of attributes created: {created_attributes}\n"
                f"• Number of values ​​created: {created_values}"
            )
        )
